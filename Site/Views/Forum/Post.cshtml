@using Site.Data.Models.Post;
@using Site.Data.Models;
@using Site.Data.Models.User
@using Site.Data.Models.UserIdentity
@using Common.Entity
@model IIdentified<VisualPost>

@{
    Layout = "_HomeLayout";
}
<h3>Автор</h3>
    @await Html.PartialAsync("~/Views/User/UserInfo.cshtml",
    new Identified<UserInfo>(Model,Model.Value.Author))
    <hr/>
    @await Html.PartialAsync("PostPreview", Model)
    <p>@Model?.Value.Created</p>
    <p>@Model?.Value.Content</p>
    @if (Model.UserId == Model.Value.Author.Id || Model.Type == UserType.Moderator)
    {  
        <hr/>
        <h2>Управление</h2>
        <p>Изменить заголовок</p>
        <form asp-controller="Forum"
              asp-action="UpdateTitle">
            <input type="hidden" name="login" value="@Model.Login"/>
            <input type="hidden" name="password" value="@Model.Password"/>
            <input type="hidden" name="type" value="@Model.Type"/>
            <input type="hidden" name="userId" value="@Model?.UserId"/>
            <input type="hidden" name="id" value="@Model?.Value.Id"/>
            <p><textarea cols="80" rows="2" name="title">@Model.Value.Title</textarea></p>
            <p><input type="submit" value="Подтвердить"/></p><hr/>
        </form>
        <p>Изменить содержание</p>
        <form asp-controller="Forum"
              asp-action="UpdateContent">
            <input type="hidden" name="login" value="@Model.Login"/>
            <input type="hidden" name="password" value="@Model.Password"/>
            <input type="hidden" name="type" value="@Model.Type"/>
            <input type="hidden" name="userId" value="@Model?.UserId"/>
            <input type="hidden" name="id" value="@Model?.Value.Id"/>
            <p><textarea cols="80" rows="10" name="content">@Model.Value.Content</textarea></p>
            <p><input type="submit" value="Подтвердить"/></p><hr/>
        </form>
        <p>Изменить картинку</p>
        <form asp-controller="Forum"
              asp-action="UpdatePicture"
              enctype="multipart/form-data">
            <input type="hidden" name="login" value="@Model.Login"/>
            <input type="hidden" name="password" value="@Model.Password"/>
            <input type="hidden" name="type" value="@Model.Type"/>
            <input type="hidden" name="userId" value="@Model?.UserId"/>
            <input type="hidden" name="id" value="@Model?.Value.Id"/>
            <p><input type="file" name="picture"/></p>
            <p><input type="submit" value="Подтвердить"/></p>
        </form>
    }
<hr/>
<h2>Комментарии</h2>
<hr style="opacity:0">
    @await Html.PartialAsync("~/Views/Chat/ChatPartial.cshtml",
    new Identified<Chat>(Model,Model.Value.Chat))
